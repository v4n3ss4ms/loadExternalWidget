const CREDIT_AGREEMENTS_URL="http://localhost:8080/credit_agreements",EVENTS_URL="http://localhost:8080/events",SELECT_ID="instalment_select",WIDGET_STYLES=`
  .instalments-widget {
    padding: 10px;
    width: 100%;
  }
  .instalment-select {
    width: 100%;
  }
  .selection--header {
    display: flex;
    justify-content: space-between;
  }
  .mode-info--title {
    padding: 5px;
    display: flex;
    justify-content: space-between;
  }
  .mode-info--steps {
    padding: 5px;
  }
  .mode-info--steps ol {
    list-style: none;
  }
  .mode-info--steps li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
  }
  .mode-info--wrapper {
    position: fixed;
    z-index: 1;
    padding-top: 100px;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgb(0,0,0);
    background-color: rgba(0,0,0,0.4);
  }
  .mode-info--content {
    background-color: #fefefe;
    margin: auto;
    padding: 20px;
    border: 1px solid #888;
    width: 50%;
    max-width: 600px;
  }
`,sendTracking=e=>{fetch(EVENTS_URL,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).catch(e=>console.error("Tracking is not sent"))},getDataTracking=(e,t,n=void 0)=>({context:e,type:t,selectedInstalment:n}),getCreditAgreements=e=>fetch(CREDIT_AGREEMENTS_URL+"?totalWithTax="+e).then(e=>e.json()),getModal=e=>{return`
    <div class="modal_more_info mode-info--wrapper">
      <div class="mode-info--content">
        <div class="mode-info--title">
          <div>Fracciona tu pago</div>
          <div>seQura <a href="#" class="modal_more_info_close">close</a></div>
        </div>
        <ol class="mode-info--steps">
          <li>
            <div>Eliges "Fracciona tu pago" al realizar tu pedido y pagas sólo la primera cuota.</div>
            <div><img src="../assets/icons/payment.png" width="75px"></div>
          </li>
          <li>
            <div>Recibes tu pedido</div>
            <div><img src="../assets/icons/shipment.png" width="75px"></div>
          </li>
          <li>
            <div>El resto de pagos se cargarán automáticamente en tu tarjeta.</div>
            <div><img src="../assets/icons/card.png" width="75px"></div>
          </li>
        </ol>
        <p>¡Así de simple!</p>
        <p>Además, en el importe mostrado ya se incluye la cuota única mensual de ${e}/mes, por lo que no tendrás ninguna sorpresa.</p>
      </div>
    </div>
    `},getInstalmentOption=e=>{return`<option value="${e.instalment_count}" data-fee="${e.instalment_fee.string}" >${e.instalment_count} cuotas de ${e.instalment_total.string}/mes </option>`},getInstalmentOptions=e=>{e=e.reduce((e,t)=>e+getInstalmentOption(t),"");return`
      <select name="instalments" id="${SELECT_ID}" class="instalment-select">
        ${e}
      </select>
    `},getWidget=e=>{e=getInstalmentOptions(e);return`
    <div class="instalments-widget">
      <div class="selection--header">
        <label for="${SELECT_ID}">Págalo en</label>
        <a href="#" class="more_info">más info</a>
      </div>
      ${e}
    </div>
    `},addWidgetStyles=(()=>{const t=document.createElement("style");return document.head.append(t),e=>t.textContent=e})(),closeModal=e=>{e.preventDefault(),document.getElementsByClassName("modal_more_info")[0].remove(),sendTracking(getDataTracking("checkoutWidget","closeModal"))},openModal=e=>{e.preventDefault();var t=document.querySelector(`#${SELECT_ID} option[selected="true"]`).getAttribute("data-fee"),t=getModal(t);e.target.insertAdjacentHTML("afterend",t),document.getElementsByClassName("modal_more_info_close")[0].addEventListener("click",closeModal,!1),sendTracking(getDataTracking("checkoutWidget","openModal"))},setSelectedByDefault=()=>{document.querySelector(`#${SELECT_ID} option`).setAttribute("selected",!0)},selectOnChange=e=>{var t=e.target,e=e.target.value;t.querySelector('option[selected="true"]').setAttribute("selected",!1),t.querySelector(`option[value="${e}"]`).setAttribute("selected",!0),sendTracking(getDataTracking("checkoutWidget","simulatorInstalmentChanged",e))},addEventListenerToElements=e=>{var t=e.getElementsByClassName("more_info")[0],e=e.querySelector("#"+SELECT_ID);t.addEventListener("click",openModal,!1),e.addEventListener("change",selectOnChange,!1)},renderWidget=(n,e)=>{try{getCreditAgreements(e).then(e=>{var t=document.getElementById(n),e=getWidget(e);addWidgetStyles(WIDGET_STYLES),t.innerHTML=e,setSelectedByDefault(),addEventListenerToElements(t),sendTracking(getDataTracking("checkoutWidget","onLoad"))})}catch{console.error("Widget not available"),sendTracking(getDataTracking("checkoutWidget","loadError"))}},renderInstalmentsWidget=()=>window.renderInstalmentsWidget=renderWidget;export default renderInstalmentsWidget();